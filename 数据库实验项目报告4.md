# 《数据库系统》课程设计报告



## 基本信息

**题目**：医药销售管理系统

**小组成员信息**：

| 姓名 | 学号 | 班级 | 分工 |
|------|------|------|------|
|      |      |      | 数据库设计、后端开发 |
|      |      |      | 需求分析、前端开发 |
|      |      |      | 系统测试、文档编写 |

**提交时间**：2026年1月3日



## 一、开发环境与开发工具

（待补充）



## 二、系统需求分析（5分）

（待补充）



## 三、功能需求分析（10分）

（待补充）



## 四、系统设计（25分）

### 4.1 数据概念结构设计（系统ER图）（10分）

（待补充）

### 4.2 数据库关系模式设计（10分）
**关系模式（按业务分组，PK下划线，FK标注→表.列）**

- t_employee(_emp_id_, emp_name, pwd, role, phone, status, created_at)
	- 候选键: phone
- t_supplier(_sup_id_, sup_name, contact_name, phone, address, license_no, status, created_at)
	- 候选键: sup_name, phone
- t_customer(_cus_id_, cus_name, gender, phone, age, medical_history, total_consume, created_at)
	- 候选键: phone
- t_medicine(_med_id_, med_name, spec, category, unit, factory, ref_buy_price, ref_sell_price, total_stock, alert_qty, created_at, updated_at)

**采购与库存**

- t_purchase_order(_po_id_, sup_id→t_supplier.sup_id, emp_id→t_employee.emp_id, total_amount, purchase_date, status)
- t_purchase_detail(_pd_id_, po_id→t_purchase_order.po_id, med_id→t_medicine.med_id, batch_no, produce_date, expiry_date, quantity, unit_purc_price)
- t_stock_batch(_batch_id_, med_id→t_medicine.med_id, batch_no, expiry_date, cur_batch_qty, create_time)
	- 约束: UNIQUE(med_id, batch_no)
- t_inventory_check(_check_id_, batch_id→t_stock_batch.batch_id, book_qty, actual_qty, diff_qty, diff_amount, emp_id→t_employee.emp_id, check_time, remark)

**销售与退货**

- t_sales_order(_so_id_, emp_id→t_employee.emp_id, cus_id→t_customer.cus_id, sale_time, total_price, status)
- t_sales_detail(_sd_id_, so_id→t_sales_order.so_id, batch_id→t_stock_batch.batch_id, med_id→t_medicine.med_id, quantity, unit_sell_price)
- t_purchase_return(_pr_id_, po_id→t_purchase_order.po_id, sup_id→t_supplier.sup_id, batch_id→t_stock_batch.batch_id, quantity, return_time, reason, status, emp_id→t_employee.emp_id)
- t_sales_return(_sr_id_, so_id→t_sales_order.so_id, batch_id→t_stock_batch.batch_id, quantity, return_time, reason, status, emp_id→t_employee.emp_id)

**财务统计**

- t_finance_daily(_day_id_, sales_revenue, sales_profit, sales_return_amt, purc_return_amt, inv_loss_amt, inv_gain_amt, net_profit, created_at, updated_at)


### 4.3 数据库物理结构设计（5分）
- 存储引擎: 全部表使用 InnoDB，支持事务与行级锁。
- 字符集/排序规则: utf8mb4 / utf8mb4_unicode_ci，兼容中文与表情。
- 索引设计（覆盖高频查询列）：
	- t_medicine: idx_medicine_name(med_name), idx_medicine_category(category)
	- t_stock_batch: idx_stock_batch_no(batch_no), idx_stock_expiry(expiry_date)
	- t_purchase_order: idx_purchase_date(purchase_date)
	- t_sales_order: idx_sales_time(sale_time)
	- t_supplier: idx_supplier_name(sup_name)
- 视图: v_expired_drugs(临期/过期), v_low_stock(缺货预警), v_stock_detail(批次库存), v_sales_statistics(日销售统计), v_top_selling(畅销榜)。
- 触发器: 5个
	- trg_after_purchase_detail_insert: 采购入库后创建/累加库存批次并更新 total_stock。
	- trg_after_sales_detail_insert: 销售出库后扣减批次与总库存。
	- trg_after_sales_return_insert: 销售退货恢复批次与总库存。
	- trg_after_purchase_return_insert: 采购退货扣减批次与总库存。
	- trg_after_inventory_check_insert: 盘点后按实物数校正批次与总库存。
- 存储过程/函数: fn_generate_po_id、fn_generate_so_id（生成单号）；sp_monthly_report（月度统计）。
- 安全与约束: CHECK(age, quantity>0)、UNIQUE(phone/med_id+batch_no)、外键全覆盖，确保引用完整性。


## 五、系统功能的实现（10分）

（待补充）



## 六、总结

（待补充）



## 附录

（待补充）
