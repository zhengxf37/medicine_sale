# 《数据库系统》课程设计报告



## 基本信息

**题目**：医药销售管理系统

**小组成员信息**：

| 姓名 | 学号 | 分工 |
|------|------|------|
| 周宏杰 | 23336346 | 承担数据库管理员工作，完成数据库关系模式和物理模式设计，并且实现了软件的部分功能 |
|        |          |                                                              |
|      |      |                                                              |

## 一、开发环境与开发工具

（待补充）



## 二、系统需求分析（5分）

（待补充）



## 三、功能需求分析（10分）

（待补充）



## 四、系统设计（25分）

### 4.1 数据概念结构设计（系统ER图）（10分）

==er图的营业额错误，不是实体==

![image-20260105170920746](./assets/image-20260105170920746.png)

### 4.2 数据库关系模式设计（10分）

==已经确认==

根据er图，可以得到数据库的关系模式：

#### 关系模式



medicine(med_id, med_name, spec, category, unit, factory, ref_buy_price, ref_sell_price, total_stock, alert_qty) 主键：med_id

supplier(sup_id, sup_name, contact_name, phone, address, license_no, status) 主键：sup_id

employee(emp_id, emp_name, pwd, role, phone) 主键：emp_id

customer(cus_id, cus_name, gender, phone, age, medical_history, total_consume) 主键：cus_id

purchase_order(po_id, total_amount, purchase_date, sup_id, emp_id) 主键：po_id 外键：sup_id, emp_id

purchase_detail(pd_id, med_id, batch_no, produce_date, expire_date, quantity, unit_purc_price, po_id) 主键：pd_id 外键：med_id, po_id

stock_batch(batch_id, med_id, pd_id, batch_no, expiry_date, cur_batch_qty, create_time) 主键：batch_id 外键：med_id, pd_id

sales_order(so_id, sale_time, total_price, cus_id, emp_id) 主键：so_id 外键：cus_id, emp_id

sales_detail(sd_id, med_id, batch_id, quantity, unit_sell_price, so_id) 主键：sd_id 外键：med_id, batch_id, so_id

inventory_check(check_id, batch_id, book_qty, actual_qty, diff_qty, diff_amount, emp_id, check_time, remark) 主键：check_id 外键：batch_id, emp_id

sales_return(sr_id, so_id, emp_id, batch_id, quantity, return_time, reason) 主键：sr_id 外键：so_id, emp_id, batch_id

purchase_return(pr_id, po_id, sup_id, batch_id, quantity, return_time, reason) 主键：pr_id 外键：po_id, sup_id, batch_id








### 4.3 数据库物理结构设计（5分）
- 存储引擎: 全部表使用 InnoDB，支持事务与行级锁。
- 字符集/排序规则: utf8mb4 / utf8mb4_unicode_ci，兼容中文与表情。
- 索引设计（覆盖高频查询列）：
	- t_medicine: idx_medicine_name(med_name), idx_medicine_category(category)
	- t_stock_batch: idx_stock_batch_no(batch_no), idx_stock_expiry(expiry_date)
	- t_purchase_order: idx_purchase_date(purchase_date)
	- t_sales_order: idx_sales_time(sale_time)
	- t_supplier: idx_supplier_name(sup_name)
- 视图: v_expired_drugs(临期/过期), v_low_stock(缺货预警), v_stock_detail(批次库存), v_sales_statistics(日销售统计), v_top_selling(畅销榜)。
- 触发器: 5个
	- trg_after_purchase_detail_insert: 采购入库后创建/累加库存批次并更新 total_stock。
	- trg_after_sales_detail_insert: 销售出库后扣减批次与总库存。
	- trg_after_sales_return_insert: 销售退货恢复批次与总库存。
	- trg_after_purchase_return_insert: 采购退货扣减批次与总库存。
	- trg_after_inventory_check_insert: 盘点后按实物数校正批次与总库存。
- 存储过程/函数: fn_generate_po_id、fn_generate_so_id（生成单号）；sp_monthly_report（月度统计）。
- 安全与约束: CHECK(age, quantity>0)、UNIQUE(phone/med_id+batch_no)、外键全覆盖，确保引用完整性。


## 五、系统功能的实现（10分）

（待补充）



## 六、总结

（待补充）



## 附录

（待补充）
