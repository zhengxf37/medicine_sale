# 药品销售管理系统 - 功能测试清单

## 测试环境
- **访问地址**: http://127.0.0.1:5000
- **测试账号**:
  - 管理员: emp_id=1001, password=123456 (Admin权限)
  - 库管员: emp_id=1002, password=123456 (Stock权限)
  - 销售员: emp_id=1003, password=123456 (Sales权限)

---

## 一、登录与认证模块 (/auth)

### 1.1 登录功能
- [ ] **URL**: http://127.0.0.1:5000/login
- [ ] **测试步骤**:
  1. 访问登录页面
  2. 输入 emp_id: 1001, password: 123456
  3. 点击登录
- [ ] **预期结果**: 跳转到首页，显示欢迎信息

### 1.2 首页
- [ ] **URL**: http://127.0.0.1:5000/
- [ ] **测试内容**:
  - 显示系统概览数据
  - 过期药品数量
  - 低库存预警数量
  - 近期销售额
- [ ] **权限**: 所有登录用户

### 1.3 员工管理
- [ ] **URL**: http://127.0.0.1:5000/employees
- [ ] **测试功能**:
  - 查看员工列表
  - 添加新员工
  - 编辑员工信息
  - 停用/启用员工
- [ ] **权限**: 仅Admin

---

## 二、药品管理模块 (/medicine)

### 2.1 药品列表
- [ ] **URL**: http://127.0.0.1:5000/medicine/
- [ ] **测试内容**:
  - 查看所有药品
  - 搜索药品（按名称、类别）
  - 分页功能
- [ ] **权限**: 所有角色

### 2.2 添加药品
- [ ] **URL**: http://127.0.0.1:5000/medicine/add
- [ ] **测试数据**:
  ```
  药品名称: 维生素C片
  规格: 100mg*100片
  类别: OTC
  单位: 瓶
  生产厂家: XX制药
  参考进价: 10.00
  参考售价: 18.00
  预警线: 20
  ```
- [ ] **权限**: Admin, Stock

### 2.3 药品详情
- [ ] **URL**: http://127.0.0.1:5000/medicine/detail/1
- [ ] **测试内容**:
  - 查看药品基本信息
  - 查看库存批次
  - 查看销售历史
- [ ] **权限**: 所有角色

---

## 三、供应商管理模块 (/supplier)

### 3.1 供应商列表
- [ ] **URL**: http://127.0.0.1:5000/supplier/
- [ ] **测试内容**: 查看所有供应商
- [ ] **权限**: Admin, Stock

### 3.2 添加供应商
- [ ] **URL**: http://127.0.0.1:5000/supplier/add
- [ ] **测试数据**:
  ```
  供应商名称: 测试医药公司
  联系人: 张三
  电话: 13900000000
  地址: 北京市朝阳区
  许可证号: TEST-2026-001
  ```
- [ ] **权限**: Admin, Stock

---

## 四、客户管理模块 (/customer)

### 4.1 客户列表
- [ ] **URL**: http://127.0.0.1:5000/customer/
- [ ] **测试内容**: 查看所有客户
- [ ] **权限**: Admin, Sales

### 4.2 添加客户
- [ ] **URL**: http://127.0.0.1:5000/customer/add
- [ ] **测试数据**:
  ```
  客户姓名: 测试客户
  性别: 男
  手机号: 13800138000
  年龄: 30
  病史: 无
  ```
- [ ] **权限**: Admin, Sales

---

## 五、采购管理模块 (/purchase)

### 5.1 采购单列表
- [ ] **URL**: http://127.0.0.1:5000/purchase/
- [ ] **测试内容**:
  - 查看所有采购单
  - 按日期筛选
  - 查看单据状态
- [ ] **权限**: Admin, Stock

### 5.2 创建采购单
- [ ] **URL**: http://127.0.0.1:5000/purchase/create
- [ ] **测试步骤**:
  1. 选择供应商
  2. 添加药品明细:
     - 选择药品: 阿莫西林胶囊
     - 批号: TEST20260103
     - 生产日期: 2026-01-01
     - 有效期: 2028-01-01
     - 数量: 100
     - 进货单价: 8.50
  3. 提交采购单
- [ ] **预期结果**: 
  - 生成采购单号（P20260103xxxx）
  - 自动创建库存批次
  - 更新药品总库存
- [ ] **权限**: Admin, Stock

### 5.3 采购单详情
- [ ] **URL**: http://127.0.0.1:5000/purchase/detail/P20260103xxxx
- [ ] **测试内容**:
  - 查看采购单头信息
  - 查看明细列表
  - 撤销采购单
- [ ] **权限**: Admin, Stock

---

## 六、库存管理模块 (/stock)

### 6.1 库存概览
- [ ] **URL**: http://127.0.0.1:5000/stock/
- [ ] **测试内容**:
  - 总库存价值
  - 药品总数
  - 批次总数
  - 低库存药品数量
  - 即将过期药品数量
- [ ] **权限**: Admin, Stock

### 6.2 批次列表
- [ ] **URL**: http://127.0.0.1:5000/stock/batch
- [ ] **测试内容**:
  - 查看所有批次
  - 按药品搜索
  - 按批号搜索
  - 显示库存数量、有效期
- [ ] **权限**: Admin, Stock

### 6.3 近效期药品
- [ ] **URL**: http://127.0.0.1:5000/stock/expiring
- [ ] **测试内容**:
  - 查看6个月内到期的药品
  - 按到期时间排序
  - 显示剩余天数
- [ ] **权限**: Admin, Stock

### 6.4 低库存预警
- [ ] **URL**: http://127.0.0.1:5000/stock/low
- [ ] **测试内容**:
  - 显示库存低于预警线的药品
  - 显示缺货数量
  - 建议补货
- [ ] **权限**: Admin, Stock

### 6.5 库存盘点
- [ ] **URL**: http://127.0.0.1:5000/stock/check
- [ ] **测试步骤**:
  1. 选择批次（从已有批次中选择）
  2. 输入账面数量（自动填充）
  3. 输入实物数量
  4. 系统自动计算差异
  5. 填写备注
  6. 提交盘点
- [ ] **预期结果**:
  - 自动调整库存
  - 记录盘点历史
  - 计算盘亏/盘盈金额
- [ ] **权限**: Admin, Stock

### 6.6 盘点历史
- [ ] **URL**: http://127.0.0.1:5000/stock/check/history
- [ ] **测试内容**: 查看所有盘点记录
- [ ] **权限**: Admin, Stock

---

## 七、销售管理模块 (/sales)

### 7.1 销售单列表
- [ ] **URL**: http://127.0.0.1:5000/sales/
- [ ] **测试内容**:
  - 查看所有销售单
  - 按日期筛选
  - 显示订单状态
- [ ] **权限**: Admin, Sales

### 7.2 创建销售单
- [ ] **URL**: http://127.0.0.1:5000/sales/create
- [ ] **测试步骤**:
  1. 选择客户（可选）
  2. 添加销售明细:
     - 选择药品: 阿莫西林胶囊
     - 数量: 10
     - 售价: 15.00
  3. 系统自动分配批次（先进先出）
  4. 提交销售单
- [ ] **预期结果**:
  - 生成销售单号（S20260103xxxx）
  - 自动扣减库存
  - 更新客户消费总额
- [ ] **权限**: Admin, Sales

### 7.3 销售单详情
- [ ] **URL**: http://127.0.0.1:5000/sales/detail/S20260103xxxx
- [ ] **测试内容**:
  - 查看销售单头信息
  - 查看明细列表
  - 退货操作
- [ ] **权限**: Admin, Sales

### 7.4 销售退货
- [ ] **测试步骤**:
  1. 在销售单详情页点击"退货"
  2. 系统自动恢复库存
  3. 更新客户消费金额
- [ ] **预期结果**: 库存增加，订单状态更新
- [ ] **权限**: Admin, Sales

---

## 八、退货管理模块 (/return_manage)

### 8.1 销售退货列表
- [ ] **URL**: http://127.0.0.1:5000/return_manage/sales_return
- [ ] **测试内容**: 查看所有销售退货记录
- [ ] **权限**: Admin, Sales

### 8.2 采购退货列表
- [ ] **URL**: http://127.0.0.1:5000/return_manage/purchase_return
- [ ] **测试内容**: 查看所有采购退货记录
- [ ] **权限**: Admin, Stock

### 8.3 创建采购退货
- [ ] **URL**: http://127.0.0.1:5000/return_manage/purchase_return/add
- [ ] **测试数据**:
  ```
  原采购单号: P20260103xxxx
  供应商: 自动填充
  批号: TEST20260103
  退货数量: 10
  退货原因: 质量问题
  ```
- [ ] **预期结果**: 扣减库存
- [ ] **权限**: Admin, Stock

---

## 九、报表统计模块 (/report)

### 9.1 报表中心
- [ ] **URL**: http://127.0.0.1:5000/report/
- [ ] **测试内容**: 显示所有可用报表入口
- [ ] **权限**: Admin, Sales, Stock

### 9.2 销售报表
- [ ] **URL**: http://127.0.0.1:5000/report/sales
- [ ] **测试参数**:
  - 报表类型: 日报表 / 月报表
  - 开始日期: 2026-01-01
  - 结束日期: 2026-01-31
- [ ] **预期内容**:
  - 订单数量
  - 销售数量
  - 销售金额
  - 销售利润
- [ ] **权限**: Admin

### 9.3 畅销药品排行
- [ ] **URL**: http://127.0.0.1:5000/report/top_selling
- [ ] **测试内容**:
  - TOP 10 畅销药品
  - 销售数量
  - 销售金额
  - 订单数量
- [ ] **权限**: Admin

### 9.4 利润分析
- [ ] **URL**: http://127.0.0.1:5000/report/profit
- [ ] **测试参数**:
  - 年份: 2026
  - 月份: 1
- [ ] **预期内容**:
  - 销售收入
  - 销售成本
  - 毛利润
  - 采购支出
  - 盘点损益
  - 毛利率
- [ ] **权限**: Admin

### 9.5 库存价值评估
- [ ] **URL**: http://127.0.0.1:5000/report/inventory_value
- [ ] **测试内容**:
  - 按类别统计库存
  - 库存成本
  - 库存价值
  - 总计数据
- [ ] **权限**: Admin, Stock

---

## 十、财务管理模块 (/finance)

### 10.1 日结报表
- [ ] **URL**: http://127.0.0.1:5000/finance/daily
- [ ] **测试参数**: 选择日期
- [ ] **预期内容**:
  - 销售收入
  - 销售利润
  - 退货金额
  - 盘点损益
  - 净利润
- [ ] **权限**: Admin

### 10.2 月度报表
- [ ] **URL**: http://127.0.0.1:5000/finance/monthly
- [ ] **测试参数**: 年份、月份
- [ ] **预期内容**: 月度财务汇总
- [ ] **权限**: Admin

### 10.3 年度报表
- [ ] **URL**: http://127.0.0.1:5000/finance/annual
- [ ] **测试参数**: 年份
- [ ] **预期内容**: 年度财务汇总
- [ ] **权限**: Admin

---

## 十一、自动化测试脚本

### 测试数据准备
在开始测试前，需要有基础测试数据（init.sql已包含）：
- ✅ 3个员工账号
- ✅ 3个供应商
- ✅ 5种药品
- ✅ 3个客户
- ⚠️ 需要手工创建采购单和销售单进行业务流程测试

### 完整业务流程测试

#### 流程1: 采购入库 → 销售出库 → 库存更新
```
1. 登录库管员账号(1002)
2. 创建采购单 → 验证库存增加
3. 登录销售员账号(1003)
4. 创建销售单 → 验证库存减少
5. 验证药品总库存正确
```

#### 流程2: 销售退货 → 库存恢复
```
1. 登录销售员账号(1003)
2. 找到已完成的销售单
3. 执行退货操作
4. 验证库存恢复
5. 验证客户消费金额减少
```

#### 流程3: 库存盘点 → 调整库存
```
1. 登录库管员账号(1002)
2. 选择批次进行盘点
3. 输入实物数量（与账面不符）
4. 提交盘点
5. 验证库存已调整
6. 查看盘点历史记录
```

#### 流程4: 过期药品处理
```
1. 查看近效期药品列表
2. 识别即将过期药品
3. 创建采购退货单
4. 验证库存扣减
```

---

## 十二、API接口测试

### 12.1 供应商列表API
- [ ] **URL**: http://127.0.0.1:5000/supplier/api/list
- [ ] **方法**: GET
- [ ] **预期**: 返回JSON格式供应商列表

### 12.2 库存查询API
- [ ] **URL**: http://127.0.0.1:5000/sales/api/available_stock/1
- [ ] **方法**: GET
- [ ] **预期**: 返回指定药品的可用库存批次

### 12.3 销售图表API
- [ ] **URL**: http://127.0.0.1:5000/report/api/sales_chart
- [ ] **方法**: GET
- [ ] **预期**: 返回销售趋势图表数据

---

## 十三、权限控制测试

### 测试矩阵

| 功能模块 | Admin | Sales | Stock |
|---------|-------|-------|-------|
| 员工管理 | ✅ | ❌ | ❌ |
| 药品管理 | ✅ | 🔍 | ✅ |
| 供应商管理 | ✅ | ❌ | ✅ |
| 客户管理 | ✅ | ✅ | ❌ |
| 采购管理 | ✅ | ❌ | ✅ |
| 库存管理 | ✅ | ❌ | ✅ |
| 销售管理 | ✅ | ✅ | ❌ |
| 报表中心 | ✅ | ✅ | ✅ |
| 财务管理 | ✅ | ❌ | ❌ |

图例: ✅ 完全权限 | 🔍 仅查看 | ❌ 无权限

### 权限测试步骤
1. 使用销售员账号(1003)登录
2. 尝试访问 http://127.0.0.1:5000/purchase/
3. **预期**: 显示"无权限访问"或重定向

---

## 十四、数据库完整性测试

### 触发器测试
- [ ] **进货触发器**: 采购后库存自动增加
- [ ] **销售触发器**: 销售后库存自动减少
- [ ] **退货触发器**: 退货后库存正确恢复
- [ ] **盘点触发器**: 盘点后库存调整

### 视图测试
```sql
-- 测试过期药品视图
SELECT * FROM v_expired_drugs LIMIT 5;

-- 测试低库存视图
SELECT * FROM v_low_stock;

-- 测试库存明细视图
SELECT * FROM v_stock_detail LIMIT 10;

-- 测试销售统计视图
SELECT * FROM v_sales_statistics LIMIT 10;

-- 测试畅销药品视图
SELECT * FROM v_top_selling;
```

### 存储函数测试
```sql
-- 测试生成进货单号
SELECT fn_generate_po_id();

-- 测试生成销售单号
SELECT fn_generate_so_id();
```

---

## 十五、性能测试

### 页面加载时间
- [ ] 首页加载 < 1秒
- [ ] 列表页加载 < 2秒
- [ ] 报表生成 < 3秒

### 并发测试
- [ ] 10个用户同时创建销售单
- [ ] 验证库存扣减正确性
- [ ] 无死锁或数据错误

---

## 测试完成标准

✅ **基础功能**: 所有CRUD操作正常
✅ **业务流程**: 采购-销售-退货-盘点流程完整
✅ **权限控制**: 角色权限隔离正确
✅ **数据完整性**: 触发器、视图、存储过程工作正常
✅ **用户体验**: 页面响应快速，操作流畅
✅ **数据准确性**: 库存计算、财务统计准确无误

---

**测试人员**: ___________  
**测试日期**: 2026-01-03  
**测试环境**: Windows + MySQL 8.0 + Flask 3.0 + Python 3.11
